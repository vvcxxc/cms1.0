<!DOCTYPE html>
<html lang="en">
 
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>elementPlus-tree</title>
  <!-- Import Vue 3 -->
  <script src="./vue3/index.js"></script>
  <!-- Import style -->
  <link rel="stylesheet" href="./element-plus/index.css" />
  <!-- Import component library -->
  <script src="./element-plus/index.js"></script>
  <!-- 引入icons 若未使用element-plus-icon 则可以移除该引用 -->
  <script src="./element-plus/icons.js"></script>
  <link rel="stylesheet" href="./styles/rewriteElement.css" />
  <link rel="stylesheet" href="./styles/index.css" />
</head>
<style>
</style>
 
<body>
  <div id="app">
    <div class="wrap">
      <div class="header" >
        <div>{{ rootData }}</div>
      </div>
      <div class="tree-container" >
        <el-tree
          ref="treeRef"
          class="custom-tree"
          node-key="Id"
          :data="treeData"
          :props="defaultProps"
          :expand-on-click-node="false"
          highlight-current
          @node-click="handleNodeClick"
          default-expand-all
        >
          <template #default="{ node, data }">
            <div class="custom-tree-node" >
              <div class="parent-node" v-if="[0, 1].includes(data.NodeType)" ></div>
              <div class="child-node" v-else-if="[2, 3].includes(data.NodeType)" ></div>
              <div class="custom_node_label">
                <span :class="data.NodeType === 4 ? 'floor-node': ''">{{ data.Name }}</span>
              </div>
            </div>
          </template>
        </el-tree>
      </div>
    </div>
  </div>
</body>
 
</html>
<script>
  // vue3 部分
  const { ref, nextTick, onMounted } = Vue
  const treeComponent = {
    setup() {
      const rootData = ref('工序定义')
      const treeData = ref([{
        "Children": [
          {
            "Children": [],
            "Id": "93443207-467e-489e-9a9c-f588831bb2bc",
            "Name": "文件夹1",
            "NodeType": 1,
            "Sort": 1
          },
          {
            "Children": [
              {
                "Children": [
                  {
                    "Id": "ff189ccf-f508-45d6-a760-1c28b82273d9",
                    "Name": "default",
                    "NodeType": 4,
                    "Sort": 1
                  }
                ],
                "Id": "3e51fc00-90a2-4115-938a-553bdb476701",
                "IsSingle": true,
                "Name": "测试工序",
                "NodeType": 2,
                "Remarks": "测试工序",
                "Sort": 1
              },
              {
                "Children": [
                  {
                    "Id": "e689160a-ada1-4bcc-aefc-226d4af185ab",
                    "Name": "测试工位2",
                    "NodeType": 4,
                    "Sort": 1
                  },
                  {
                    "Id": "a5b26d03-641e-4cbd-8e99-bad4a58b2d26",
                    "Name": "测试工位3",
                    "NodeType": 4,
                    "Sort": 2
                  },
                  {
                    "Id": "16779114-b3b4-4b59-90b2-e51ca73bd5fd",
                    "Name": "测试工位4",
                    "NodeType": 4,
                    "Sort": 3
                  }
                ],
                "Id": "77ee54e2-f7b8-45e8-842c-9e3223ec2b83",
                "IsSingle": false,
                "Name": "测试工序1",
                "NodeType": 3,
                "Remarks": "测试工序1",
                "Sort": 2
              }
            ],
            "Id": "6809de1b-59c1-46a8-925f-baa8f4574086",
            "Name": "11122222",
            "NodeType": 1,
            "Sort": 2
          },
          {
            "Children": [],
            "Id": "3769bf72-6fa2-40b8-8829-57e251147467",
            "Name": "string",
            "NodeType": 1,
            "Sort": 3
          }
        ],
        "Id": null,
        "Name": "LineName",
        "NodeType": 0
      }])
      const customNodeClass = (data, node) => {
        if (data.NodeType === 4) {
          return 'floor-node-content'
        }
        return null
      }
      const defaultProps = {
        children: 'Children',
        label: 'name',
        class: customNodeClass
      }
      const renderTree = (data, node) => {
        treeData.value = data
        if (node) {
          nextTick(() => {
            treeRef.value.setCurrentKey(node.Id)
            handleNodeClick(node)
          })
        }
      }
      const currentNode = ref(null)
      const treeRef = ref('')
      let timeId = null
      let id = 1000
      const handleNodeClick = (node) => {
        if (node.CustomType) { 
          // 自定义节点不能调用JsObj方法
          treeRef.value.setCurrentKey(currentNode.value.Id)
          return 
        }
        // 2.接收传参 设置定时器防止双击事件调用两次click事件
        clearTimeout(timeId)
        timeId = setTimeout(function () {
          currentNode.value = node
          JsObj.treeNodeClick(currentNode.value)
          console.log('22222222222', currentNode.value)
        }, 250)
      }
      const getTreeData = () => {
        JsObj.treeLoaded((allData, nodeData, rootName) => {
          renderTree(allData, nodeData)
          rootData.value = rootName
        })
      }

      onMounted(() => {
        getTreeData()
      })

      return {
        treeRef,
        defaultProps,
        treeData,
        rootData,
        customNodeClass,
        renderTree,
        handleNodeClick,
      }
    },
  }
  // 创建实例
  const app = Vue.createApp(treeComponent)
  // 引入 element-plue-icons
  for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
    app.component(key, component)
  }
  // 挂载
  app.use(ElementPlus).mount("#app")
</script>